<!DOCTYPE html>
<meta charset="utf-8">

<style>
  .state {
    fill: none;
    stroke: #CCC;
    stroke-width: 1px;
  }
</style>

<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script>
    var width = 960,
    height = 500;
    var projection = d3.geo.equirectangular()
        .translate([width / 2, height / 2])
    var path = d3.geo.path().projection(projection);

    var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
        }
    }
    aa = [-122.490402, 37.786453];
    bb = [-122.389809, 37.72728];
    function showPosition(position) {
        latlong = [position.coords.longitude, position.coords.latitude];
        console.log(position.coords.latitude);
        console.log(position.coords.longitude);
        svg.selectAll('circle')
        .data([aa, bb]).enter()
        .append('circle')
        .style('fill', 'red')
        .attr('cx', function(d) {return projection(latlong)[0]})
        .attr('cy', function(d) {return projection(latlong)[1]})
        d3.selectAll('circle')
        .each(pulse);
    }
    function pulse() {
        var circle = svg.select("circle");
        (function repeat() {
            circle = circle.transition()
                .duration(2000)
                .attr("stroke-width", 20)
                .attr("r", 1)
                .transition()
                .duration(2000)
                .attr('stroke-width', 0.5)
                .attr("r", 4)
                .ease('sine')
                .each("end", repeat);
        })();
    }

    queue()
    .defer(d3.json, "/static/countries.json")
    .await(ready);

    function ready(error, us) {
      svg.append("g")
      .selectAll("path")
      .data(topojson.feature(us, us.objects.BORDERS).features)
      .enter().append("path")
      .attr("class", "state")
      .attr("d", path);
      getLocation();
    }

  </script>
</body>
