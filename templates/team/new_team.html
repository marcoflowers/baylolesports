{% extends "/templates/base.html" %}
{% block content %}
<style>
#loader {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 175px;
  height: 175px;
  margin: auto;
}
#loader .dot {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 87.5px;
  height: 100%;
  margin: auto;
}
#loader .dot:before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  width: 87.5px;
  height: 87.5px;
  border-radius: 100%;
  transform: scale(0);
}
#loader .dot:nth-child(7n+1) {
  transform: rotate(45deg);
}
#loader .dot:nth-child(7n+1):before {
  background: #00ff80;
  -webkit-animation: load 0.8s linear 0.1s infinite;
}
#loader .dot:nth-child(7n+2) {
  transform: rotate(90deg);
}
#loader .dot:nth-child(7n+2):before {
  background: #00ffea;
  -webkit-animation: load 0.8s linear 0.2s infinite;
}
#loader .dot:nth-child(7n+3) {
  transform: rotate(135deg);
}
#loader .dot:nth-child(7n+3):before {
  background: #00aaff;
  -webkit-animation: load 0.8s linear 0.3s infinite;
}
#loader .dot:nth-child(7n+4) {
  transform: rotate(180deg);
}
#loader .dot:nth-child(7n+4):before {
  background: #0040ff;
  -webkit-animation: load 0.8s linear 0.4s infinite;
}
#loader .dot:nth-child(7n+5) {
  transform: rotate(225deg);
}
#loader .dot:nth-child(7n+5):before {
  background: #2a00ff;
  -webkit-animation: load 0.8s linear 0.5s infinite;
}
#loader .dot:nth-child(7n+6) {
  transform: rotate(270deg);
}
#loader .dot:nth-child(7n+6):before {
  background: #9500ff;
  -webkit-animation: load 0.8s linear 0.6s infinite;
}
#loader .dot:nth-child(7n+7) {
  transform: rotate(315deg);
}
#loader .dot:nth-child(7n+7):before {
  background: magenta;
  -webkit-animation: load 0.8s linear 0.7s infinite;
}
#loader .dot:nth-child(7n+8) {
  transform: rotate(360deg);
}
#loader .dot:nth-child(7n+8):before {
  background: #ff0095;
  -webkit-animation: load 0.8s linear 0.8s infinite;
}

@-webkit-keyframes load {
  100% {
    opacity: 0;
    transform: scale(1);
  }
}

</style>
<div class="row" >
	<div class="col-md-6 col-md-offset-3">
		<h2 class="text-center">Create a Team</h2>
		<p class="text-center">Create a name for your team and enter in the Summoner Names of your teamates.</p>
		<form role="form" id="new_team" method="post">
		  <div class="form-group team_name">
		    <label for="team_name" class="control-label">Team Name</label>
		    <input type="text" class="form-control" name="team_name" id="team_name" placeholder="Enter Team Name">

		  </div>
		  {% for x in range(0,7) %}
		  <div class="form-group" id="{{loop.index}}">
		    <label for="player{{loop.index}}" class="control-label">Player {{loop.index}}</label>
		    <input type="text"  class="form-control" name="player{{loop.index}}" id="player{{loop.index}}" placeholder="Enter Summoner Name">
		  </div>
		  {% endfor %}
		  <div class="form-group">
		  	<label for="admin" class="control-label">Admin</label>
		  	<input name="admin" class="form-control" type="text" placeholder="{{user.email()}}" readonly>
		  </div>
		  <button type="submit" class="btn btn-default" data-loading-text="Disabled">Submit</button>
		</form>
	</div>
</div>
<script>
function checkstatus()
{
	var loop = 0
	var check=0
	$( ".form-group" ).each(function( index ) {
	if ($(this).hasClass("team_name")) {
		check=check+1
	}
  	else if($(this).hasClass("has-error"))
  	{
  		loop=-50
  	}
  	else if ($(this).hasClass("has-success"))
  	{
  		loop=loop+1
  	}
	});
	if(loop>=5 && check>=1)
	{
		$("button").button('reset')
		return true
	}
	else
	{
		$("button").button('loading')
		return false
	}
}
$( document ).ready(function() {
	$("form").submit(function(){
		$(".row").empty()
		$(".row").append("<h1>Creating your team</h1><div id='loader'><div class='dot'></div><div class='dot'></div><div class='dot'></div><div class='dot'></div><div class='dot'></div><div class='dot'></div><div class='dot'></div><div class='dot'></div></div>")
		$("button").button('loading')
	});
	$("input").focus(function(){
		$("button").button('loading')
	});
	$("button").button('loading')
	$("input").focusout(function(){
		id= $(this).attr("id")
		$(this).parent().removeClass("has-error")
		$(this).parent().removeClass("has-success")
		$(this).parent().children("label").children("small").remove()
		var sum_name = $(this).val();
		if(sum_name.length>0 && id!="team_name")
		{
			var position = $(this).parent().attr('id');
			$.ajax({
	        url: '/team/check_summoner_name/'+sum_name+"/"+position, 
	        dataType: 'json',
	        success: function(data) {
	        	var input = $("#player"+data.position)
	        	
	            if(data.id ==false)
	            {
	            	input.parent().addClass("has-error")
	            	input.parent().children("label").append("<small id='sum_name_error'>-Not a Valid Summoner Name</small>")
	            }
	            else
	            {
	            	input.parent().addClass("has-success")
	            }
	            checkstatus()
	        }
	    });
		}
	        else
	        {
	        	var position = $(this).parent().attr('id');
	        	console.log('/team/check_team_name/'+sum_name)
				$.ajax({
		        url: '/team/check_team_name/'+sum_name, 
		        dataType: 'json',
		        success: function(data) {
		        	var input = $("#team_name")
		        	console.log(data)
		            if(data.name ==false)
		            {
		            	input.parent().addClass("has-error")
		            	input.parent().children("label").append("<small id='sum_name_error'>-Not a Valid Team Name</small>")
		            }
		            else
		            {
		            	input.parent().addClass("has-success")
		            }
		            checkstatus()
	        }
		});
	}
	});
});
</script>
{% endblock %}